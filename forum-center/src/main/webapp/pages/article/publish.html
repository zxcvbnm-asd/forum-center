<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- 引入样式 -->
    <link rel="stylesheet" href="../../plugins/elementui/index.css">
    <link rel="stylesheet" href="../../plugins/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../css/style.css">
    <!-- 引入组件库 -->
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script src="../../js/vue.js"></script>
    <script src="../../plugins/elementui/index.js"></script>
    <script src="../../js/axios-0.18.0.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../ueditor/ueditor.all.min.js"> </script>

    <script type="text/javascript" charset="utf-8" src="../../ueditor/lang/zh-cn/zh-cn.js"></script>


    <style>
        body{
            background-color: white;


        }

        .center{
            margin-left: 2px;
           /* height: 500px;*/
            border-left: 1px grey solid;
            border-right: 1px grey solid;
            border-top: 1px grey solid;
        }

        .el-tag + .el-tag {
            margin-left: 10px;
        }
        .button-new-tag {
            margin-left: 10px;
            height: 32px;
            line-height: 30px;
            padding-top: 0;
            padding-bottom: 0;
        }
        .input-new-tag {
            width: 90px;
            margin-left: 10px;
            vertical-align: bottom;
        }

        el-button{
            width: 50px;
            height: 30px;
        }

        #tip{
            letter-spacing: 2px;
        }

        .breadcrumb{
            line-height: 30px;
            background-color: #f5f5f5;
        }

        #form{
            margin-top: 30px;
        }

    </style>
</head>
<body>
<div id="app">

    <el-breadcrumb separator-class="el-icon-arrow-right" class="breadcrumb">
        <el-breadcrumb-item :to="{ path: '/' }">首页</el-breadcrumb-item>
        <el-breadcrumb-item>文章管理</el-breadcrumb-item>
        <el-breadcrumb-item>文章发布</el-breadcrumb-item>
    </el-breadcrumb>
    <div class="center">
        <el-form ref="form" :model="form" label-width="80px" id="form">
            <el-form-item label="文章标题:">
                <el-input v-model="form.title"></el-input>
            </el-form-item>
            <el-form-item label="文章分类:">
                <el-select v-model="category_id" @change="change" placeholder="一级分类">
                    <el-option v-for="category in categoryOne" :label="category.name" :value="category.id"></el-option>
                </el-select>
                <el-select v-model="form.categoryId"  placeholder="二级分类">
                    <el-option v-for="category in categoryTwo" :label="category.name" :value="category.id"></el-option>
                </el-select>
            </el-form-item>


            <el-form-item label="内容">
                <div>
                    <script id="editor" type="text/plain" style="width:95%;height:700px;"></script>
                </div>

            </el-form-item>

            <el-form-item label="上传封面"><br/>
                <el-upload
                        action="https://jsonplaceholder.typicode.com/posts/"
                        list-type="picture-card"
                        :on-preview="handlePictureCardPreview"
                        :on-remove="handleRemove">
                    <i class="el-icon-plus"></i>
                </el-upload>
                <el-dialog :visible.sync="dialogVisible">
                    <img width="100%" :src="dialogImageUrl" alt="">
                </el-dialog>
            </el-form-item>


            <el-form-item label="添加标签">
                <el-tag
                        :key="tag"
                        v-for="tag in dynamicTags"
                        closable
                        :disable-transitions="false"
                        @close="handleClose(tag)">
                    {{tag}}
                </el-tag>
                <el-input
                        class="input-new-tag"
                        v-if="inputVisible"
                        v-model="inputValue"
                        ref="saveTagInput"
                        size="small"
                        @keyup.enter.native="handleInputConfirm"
                        @blur="handleInputConfirm"
                >
                </el-input>
                <el-button v-else class="button-new-tag" size="small" @click="showInput">+新增标签</el-button>
            </el-form-item>

            <el-form-item>
                <el-row>
                    <el-button type="success"  size="small" @click="publish">发&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;布</el-button>
                    <el-button type="primary" size="small" @click="timingPublish">定时发布</el-button>
                    <el-button type="info"  size="small" @click="saveDrafts">存&nbsp;草&nbsp;稿</el-button>
                    <el-button type="warning"  size="small" @click="preview">预&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;览</el-button>

                </el-row>
            </el-form-item>
        </el-form>
        <el-dialog
                title="定时发布"
                :visible.sync="centerDialogVisible"
                width="50%"
                center>
            <hr/>
            <template>
                <div class="block" style="margin-left: 100px;font-weight: bold;font-size: 15px">
                    <span class="demonstration">选择发布时间&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <el-date-picker
                            v-model="form.pubtime"
                            type="datetime"
                            placeholder="选择日期时间">
                    </el-date-picker><br><br>
                    <span id="tip">您的文章将于{{pubtime | timeformat}}发布</span>
                </div>
            </template>
            <span slot="footer" class="dialog-footer">
    <el-button @click="centerDialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="publish">确 定</el-button>
  </span>
        </el-dialog>

    </div>
</div>
</body>
<script>

   var ue = UE.getEditor('editor',{
       toolbars: [
           [
               'undo', //撤销
               'redo', //重做
               'bold', //加粗
               'indent', //首行缩进
               'italic', //斜体
               'underline', //下划线
               'strikethrough', //删除线
               'subscript', //下标
               'source', //源代码
               'blockquote', //引用
               'pasteplain', //纯文本粘贴模式
               'selectall', //全选
               'preview', //预览
               'simpleupload', //单图上传
               'insertimage', //多图上传
               'emotion', //表情
               'spechars', //特殊字符
               'searchreplace', //查询替换
               'justifyleft', //居左对齐
               'justifyright', //居右对齐
               'justifycenter', //居中对齐
               'justifyjustify', //两端对齐
               'forecolor', //字体颜色
               'backcolor', //背景色
               'rowspacingtop', //段前距
               'rowspacingbottom', //段后距
               'lineheight', //行间距
               'edittip ', //编辑提示
               'touppercase', //字母大写
               'tolowercase', //字母小写
               'background', //背景
               'template', //模板
               'scrawl', //涂鸦
               'inserttable', //插入表格
               'drafts', // 从草稿箱加载
               'charts', // 图表


           ]
       ],
   });

    Vue.filter('timeformat',function (timesatr) {
        var date;
        if(timesatr == ''){
            return "xxxx-MM-dd HH:mm:ss";
        }else {
            date = new Date(timesatr);
            var y = date.getFullYear();
            var M = date.getMonth() + 1;
            var d = date.getDate();
            var h = date.getHours();
            var m = date.getMinutes();
            var s = date.getSeconds();

            return `${y}-${M}-${d} ${h}:${m}:${s}`;
        }
    })
    var vm = new Vue({
        el:"#app",
        data:{
            category_id:'',
            form: {
                title: '',
                categoryId:'',
                desc: '',
                content:'', // 内容
                dynamicTags:'',
                status:'',  // 1.审核中  2、已发布  3、存草稿 4、发布失败
                pubtime: '',  // 后端判断发布时间是否为空，若为空，则为立即发布，直接new即可，若不是，则说明是定时发布，设置定时任务即可

            },
            dynamicTags: ['标签一', '标签二', '标签三'],
            inputVisible: false,
            inputValue: '',
            centerDialogVisible: false,
            dialogImageUrl: '',
            dialogVisible: false,
            categoryOne:[{name:'db',id:1},{name:'javavse',id:2}] , // 一级分类
            categoryTwo:[{name:'html',id:1},{name:'spring',id:2}]  // 一级分类
        },
        methods:{
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePictureCardPreview(file) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            },

            // 下拉选择框发生改变
            change(){
               var id = this.category_id;  // 一级分类的id
               // 根据一级分类的id查询二级分类，然后再赋值给二级分类
            },

            // 以html的方式获取文本，并赋值给vue中的属性
            showContent(){
                var content = UE.getEditor('editor').getContent()
                this.form.content = content;
            },



            // 定时发布
            timingPublish(){
                this.$confirm("确认发布？建议发布前再检查一遍","发布提醒",{type:"warning"}).then(()=>{
                    this.centerDialogVisible=true
                }).catch(()=>{
                    this.$message("已取消")
                })
            },

            // 发布
            publish(){
                this.centerDialogVisible=false;
                // 发送ajax请求添加到数据库

            },

            // 存入草稿箱
            saveDrafts(){
                // 设置文章状态
                this.form.status=3
                // 添加到数据库中
            },

            // 预览
            preview(){

            },
            // 以下三个组件标签方法
            handleClose(tag) {
                this.dynamicTags.splice(this.dynamicTags.indexOf(tag), 1);
            },

            showInput() {
                this.inputVisible = true;
                this.$nextTick(_ => {
                    this.$refs.saveTagInput.$refs.input.focus();
                });
            },

            handleInputConfirm() {
                let inputValue = this.inputValue;
                if (inputValue) {
                    this.dynamicTags.push(inputValue);
                }
                this.inputVisible = false;
                this.inputValue = '';
            },

            // 上传文件图片
            //文件上传成功后的钩子，response为服务端返回的值，file为当前上传的文件封装成的js对象
        }
    })
</script>
</html>